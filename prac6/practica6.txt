#Guillermo Cruz Rojas	682433
#Miguel Gomez Lahera	741302

--------
PARTE 1:
--------

#Maquina 192.168.56.2:

-Añadir al fichero rsyslog.conf:
local0.info @192.168.56.3:514
(El @ indica una conexion udp, la ip la maquina remota, y 514
el puerto estandar a usar)

Para evitar que nos pida la contraseña a causa del ssh hacemos:
ssh-keygen -b 4096 -t rsa
ssh-copy-id as@192.168.56.3

Para que no envie emails añadir en el fichero crontab:
MAILTO=/dev/null

Hacerlo periodico añadiendo a crontab:
HOME=/
* * * * root /home/as/prac6/practica6.sh > /dev/null


#Maquina 192.168.56.3:

-Descomentar las lineas del fichero rsyslog.conf:
module(load="imudp")
inmput(type="imdup" port="514")

-Añadir al fichero rsyslog.conf:
local0.info /var/log/monitorizacion.log


--------
PARTE 2:
--------

Para que los emails lleguen a root cambiar en el fichero logcheck.conf:
SENDMAILTO="root"

Para que lea el fichero monitorizacion.log añadir a logcheck.logfiles:
/var/log/monitorizacion.log

Para que muestre lo que queremos escribir en el fichero ignore.d.server/monitorizacion_rules:
Conexiones: [012][0-9][0-9]
Procesos:	[0123][0-9][0-9]

Las expresiones regulares escritas en el fichero monitorizacion_rules hacen que
mientras se cumpla lo que expresan lo ignorará y no enviará un correo.
La primera expresion regular, si las conexiones del usuario superan las 300 enviará
un mail a root informando
La segunda de la misma forma enviará un mail a root si supera el usuario los 400
procesos.

